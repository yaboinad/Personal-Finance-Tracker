<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Financia CSS/Financia_Reports_Css.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Financia - Reports</title>
    <style>
        @media screen and (max-width: 1920px) and (max-height: 1080px) {
            body {
                background-image: url(Financia_Dashboard_Overview_Images/Dashboard\ Overview\ Background.png), url(Financia_Dashboard_Overview_Images/Dashboard\ Overview\ Background\ 2.png);
                background-color: rgb(199, 163, 245);
                background-repeat: no-repeat;
                background-position-y: top, center;
                background-size: 1920px 1000px, 1920px 1080px;
                width: 95vw;
            }
        }

        @font-face

        /*This will be served as font style for our website*/
            {
            font-family: Roboto1;
            src: url(Financia_Fonts/roboto/Roboto-Light.ttf);
        }

        @font-face

        /*This will be served as font style for our website*/
            {
            font-family: Roboto2;
            src: url(Financia_Fonts/roboto/Roboto-Bold.ttf);
        }

        @font-face

        /*This will be served as font style for our website*/
            {
            font-family: Roboto3;
            src: url(Financia_Fonts/roboto/Roboto-Black.ttf);
        }

        @font-face {
            font-family: Coolvetica1;
            src: url(Financia_Fonts/coolvetica/coolvetica\ condensed\ rg.otf);
        }

        @font-face {
            font-family: Coolvetica2;
            src: url(Financia_Fonts/coolvetica/coolvetica\ rg.otf);
        }
    </style>
</head>
</head>

<body>
    <table class="table1">
        <tr>
            <td class="Financia_box"><a class="Financia" href="Financia.html">Financia</a></td>
            <td style="width: 50vw;"></td>
            <td class="e-pay_box">
                <img class="e-pay_button" id="epayBtn" src="Financia_Home_Page_Images/plus.png" alt="">
                <div class="dropdown-menu" id="dropdownMenuEpay">
                    <a href="Financia-E-Pay.php">E-Pay</a>
                    <a href="Financia_Goals.php">Goals</a>
                </div>
            </td>

            <td class="notification_box"><img class="notification_button"
                    src="Financia_Home_Page_Images/Notification bell.png" alt=""></td>
            <td class="account_box">
                <img class="account" id="accountBtn" src="Financia_Home_Page_Images/Account profile.png" alt="">
                <div class="dropdown-menu" id="dropdownMenuAccount">
                    <a href="Financia_Sign_In.html">Sign In</a>
                    <a href="Financia_Sign_Up.php">Sign Up</a>
                    <a href="#">Account</a>

                </div>
            </td>
            <td class="settings_box"><img class="settings_button" src="Financia_Home_Page_Images/Settings logo.png"
                    alt=""></td>
        </tr>
    </table>
    <table class="table2">
        <form action="">
            <tr>
                <td class="td_link">
                    <a class="nav_link" href="Financia_Dashboard_Overview.php">Overview</a>
                </td>
                <td class="td_link">
                    <a class="nav_link" href="Financia_Dashboard_Summary.html">Summary</a>
                </td>
                <td class="td_link">
                    <a class="nav_link" href="Financia_History.php">History</a>
                </td>
                <td class="td_link">
                    <a class="nav_link" href="Financia_Transactions.html">Transactions</a>
                </td>
                <td class="td_link">
                    <a class="nav_link" href="Financia_Reports.html">Reports</a>
                </td>
            </tr>
        </form>
    </table>

    <!-- Income Report -->
    <div class="container">
        <div class="header">
            <!-- Left Group -->
            <div class="header-left">
                <input type="date" id="startDate" placeholder="Starting Date">
                <input type="date" id="endDate" placeholder="Ending Date">
            </div>

            <!-- Right Group -->
            <div class="header-right">
                <select>
                    <option>Starting Date</option>
                </select>
                <select>
                    <option>Ending Date</option>
                </select>
            </div>
        </div>
        <div class="report-section">
            <h1>Income Report</h1>
            <div class="amounts">
                <div class="amount-box" id="depositAmount1">₱0.00</div>
                <div class="amount-box" id="depositAmount2">₱0.00</div>
            </div>
        </div>
        <div class="button-row">
            <button>Check Income</button>
            <button>View Report</button>
            <button>Check Income</button>
        </div>
    </div>
    <div class="summary-container">
        <table class="summary-table">
            <thead>
                <tr>
                    <th>Total Income</th>
                    <th>Percent Change</th>
                    <th>Average Income Per Week</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>₱0.00</td>
                    <td>58.82%</td>
                    <td>₱22,000</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Expenses Report -->
    <div class="container">
        <div class="header">
            <!-- Left Group -->
            <div class="header-left">
                <select>
                    <option>Starting Date</option>
                </select>
                <select>
                    <option>Ending Date</option>
                </select>
            </div>

            <!-- Right Group -->
            <div class="header-right">
                <select>
                    <option>Starting Date</option>
                </select>
                <select>
                    <option>Ending Date</option>
                </select>
            </div>
        </div>
        <div class="report-section">
            <h1>Expenses Report</h1>
            <div class="amounts">
                <div class="amount-box">₱14,000</div>
                <div class="amount-box">₱24,000</div>
            </div>
        </div>
        <div class="button-row">
            <button>Check Expenses</button>
            <button>View Report</button>
            <button>Check Expenses</button>
        </div>
    </div>
    <div class="summary-container">
        <table class="summary-table">
            <thead>
                <tr>
                    <th>Total Expenses</th>
                    <th>Percent Change</th>
                    <th>Average Expenses Per Week</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>₱38,000</td>
                    <td>71.42%</td>
                    <td>₱9,500</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Net Saviongs Report -->
    <div class="container">
        <div class="header">
            <!-- Left Group -->
            <!--<div class="header-left">
                <select>
                    <option>Starting Date</option>
                </select>
                <select>
                    <option>Ending Date</option>
                </select>
            </div>

             Right Group 
            <div class="header-right">
                <select>
                    <option>Starting Date</option>
                </select>
                <select>
                    <option>Ending Date</option>
                </select>
            </div> -->
        </div>
        <div class="report-section">
            <h1>Net Savings Report</h1>
            <div class="amounts">
                <div class="amount-box">₱20,000</div>
                <div class="amount-box">₱30,000</div>
            </div>
        </div>
        <div class="button-row">
            <button>Check Net Savings</button>
            <button>View Report</button>
            <button>Check Net Savings</button>
        </div>
    </div>
    <div class="summary-container">
        <table class="summary-table">
            <thead>
                <tr>
                    <th>Total Net Savings</th>
                    <th>Percent Change</th>
                    <th>Average Net Savings Per Week</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>₱88,000</td>
                    <td>58.82%</td>
                    <td>₱22,000</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Goal report -->
    <div class="goal-container">
        <div class="goal-header">
            <h1>Goals Report</h1>
        </div>
        <div class="goal-section">
            <div class="goal-count">
                <div class="goal-box">
                    <h3>Achieved Goals</h3>
                    50
                </div>
                <div class="goal-box">
                    <h3>Unachieved Goals</h3>
                    50
                </div>
            </div>
            <div class="content-area">
                <!-- Add any additional content here, such as summary or charts -->
                <div class="date-range">
                    <select>
                        <option>Starting Date</option>
                    </select>
                    <select>
                        <option>Ending Date</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div>
        <hr style="margin: 12vw 0 0 -1vw; border: 0.1vw solid black; width: 38vw;">
        <hr style="width: 9vw; border: 0.1vw solid black; margin: -0.2vw 0 0 40vw;">
        <hr style="width: 3vw; border: 0.1vw solid black; margin: -0.2vw 0 0 52vw;">
        <hr style="width: 39.2vw; border: 0.1vw solid black; margin: -0.2vw 0 0 58vw;">
    </div>
    <div class="div6">
        <img class="social_media_logo" src="Financia_Home_Page_Images/facebook.png" alt="">
        <img class="social_media_logo" src="Financia_Home_Page_Images/twitter.png" alt="">
        <img class="social_media_logo" src="Financia_Home_Page_Images/tiktok.png" alt="">
        <img class="social_media_logo" src="Financia_Home_Page_Images/instagram.png" alt="">
    </div>
    <table class="table5">
        <tr>
            <td class="footer_link_box"><a class="footer_links" href="Financia-AboutUs-html">About Us</a></td>
            <td class="footer_link_box"><a class="footer_links" href="">Terms & Conditions</a></td>
            <td class="footer_link_box"><a class="footer_links" href="">Privacy Policy</a></td>
            <td class="footer_link_box"><a class="footer_links" href="">Contact Us</a></td>
        </tr>
    </table>
    <br>
    <hr style="border: 0.1vw solid black; width: 99.2vw; margin: 0 -1vw 0 -1vw;">
    <p class="copyright">&copy; 2024 Financia. All Rights Reserved.</p>

    <script>
        document.getElementById('startDate').addEventListener('change', loadTransactions);
        document.getElementById('endDate').addEventListener('change', loadTransactions);

        function loadTransactions() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            // Validate the date range
            if (new Date(startDate) > new Date(endDate)) {
                alert("The starting date must be before the ending date.");
                return;
            }

            // Fetch transactions based on the selected date range
            fetch(`backend/get_transactions.php?start_date=${startDate}&end_date=${endDate}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const transactionTableBody = document.getElementById('transactionTableBody');
                        transactionTableBody.innerHTML = ''; // Clear existing rows

                        let totalIncome = 0;
                        let previousIncome = 0; // Assuming you have a way to get the previous income
                        let transactionCount = data.transactions.length;

                        data.transactions.forEach(transaction => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${transaction.description || '-'}</td>
                                <td>₱ ${parseFloat(transaction.amount).toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                                <td>${new Date(transaction.created_at).toLocaleDateString('en-PH')}</td>
                            `;
                            transactionTableBody.appendChild(row);
                            totalIncome += parseFloat(transaction.amount);
                        });

                        // Calculate average income per week
                        const daysInPeriod = (new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24);
                        const weeksInPeriod = daysInPeriod / 7;
                        const averageIncomePerWeek = totalIncome / weeksInPeriod;

                        // Calculate percentage change
                        const percentageChange = ((totalIncome - previousIncome) / previousIncome) * 100 || 0;

                        // Update the summary table
                        document.querySelector('.summary-table tbody tr td:nth-child(1)').textContent = `₱${totalIncome.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                        document.querySelector('.summary-table tbody tr td:nth-child(2)').textContent = `${percentageChange.toFixed(2)}%`;
                        document.querySelector('.summary-table tbody tr td:nth-child(3)').textContent = `₱${averageIncomePerWeek.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

                        // If no transactions are found, display a message
                        if (data.transactions.length === 0) {
                            transactionTableBody.innerHTML = `
                                <tr>
                                    <td colspan="3" style="text-align: center;">No transactions found</td>
                                </tr>
                            `;
                        }
                    } else {
                        console.error('Failed to load transactions:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error fetching transactions:', error);
                });

            // Fetch deposit amounts from E-Pay overview based on the selected date range
            fetch(`backend/get_deposit_amounts.php?start_date=${startDate}&end_date=${endDate}`)
                .then(response => response.json())
                .then(data => {
                    console.log('Deposit amounts response:', data); // Debugging line
                    if (data.success) {
                        const amounts = data.amounts;

                        // Check if amounts are defined and update the amount boxes
                        if (amounts && amounts.length > 0) {
                            document.getElementById('depositAmount1').textContent = `₱${amounts[0].toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                        } else {
                            document.getElementById('depositAmount1').textContent = '₱0.00'; // Reset if no amounts
                        }

                        if (amounts.length > 1) {
                            document.getElementById('depositAmount2').textContent = `₱${amounts[1].toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                        } else {
                            document.getElementById('depositAmount2').textContent = '₱0.00'; // Reset if no amounts
                        }
                    } else {
                        console.error('Failed to load deposit amounts:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error fetching deposit amounts:', error);
                });
        }

        // Call the function to load transactions when the page loads
        document.addEventListener('DOMContentLoaded', loadTransactions);
    </script>

    <script>
        function calculateAverageIncome(totalIncome, daysInPeriod) {
            const weeks = daysInPeriod / 7;
            return totalIncome / weeks;
        }

        function calculatePercentageChange(currentIncome, previousIncome) {
            return ((currentIncome - previousIncome) / previousIncome) * 100;
        }

        // Example usage
        const totalIncome = 70000; // Total Income
        const daysInPeriod = 35; // Number of Days in Period
        const averageIncome = calculateAverageIncome(totalIncome, daysInPeriod);
        console.log(`Average Income Per Week: ₱${averageIncome.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`);

        const currentPeriodIncome = 54000; // Current Period Income
        const previousPeriodIncome = 34000; // Previous Period Income
        const percentageChange = calculatePercentageChange(currentPeriodIncome, previousPeriodIncome);
        console.log(`Percentage Change: ${percentageChange.toFixed(2)}%`);
    </script>



</body>

</html>