<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="">
    <link rel="stylesheet" href="Financia CSS/Financia_Dashboard_Summary.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <title>Financia - Dashboard</title>
    <style>
        @media screen and (max-width: 1920px) and (max-height: 1080px) {
            body {
                background-image: url(Financia_Dashboard_Overview_Images/Dashboard\ Overview\ Background.png), url(Financia_Dashboard_Overview_Images/Dashboard\ Overview\ Background\ 2.png);
                background-color: rgb(199, 163, 245);
                background-repeat: no-repeat;
                background-position-y: top, center;
                background-size: 1920px 800px, 1920px 1080px;
                width: 95vw;
            }
        }

        @font-face

        /*This will be served as font style for our website*/
            {
            font-family: Roboto1;
            src: url(Financia_Fonts/roboto/Roboto-Light.ttf);
        }

        @font-face

        /*This will be served as font style for our website*/
            {
            font-family: Roboto2;
            src: url(Financia_Fonts/roboto/Roboto-Bold.ttf);
        }

        @font-face

        /*This will be served as font style for our website*/
            {
            font-family: Roboto3;
            src: url(Financia_Fonts/roboto/Roboto-Black.ttf);
        }

        @font-face {
            font-family: Coolvetica1;
            src: url(Financia_Fonts/coolvetica/coolvetica\ condensed\ rg.otf);
        }

        @font-face {
            font-family: Coolvetica2;
            src: url(Financia_Fonts/coolvetica/coolvetica\ rg.otf);
        }
    </style>
</head>

<body>
    <table class="table1">
        <tr>
            <td class="Financia_box"><a class="Financia" href="Financia.php">Financia</a></td>
            <td style="width: 50vw;"></td>
            <td class="e-pay_box">
                <img class="e-pay_button" id="epayBtn" src="Financia_Home_Page_Images/plus.png" alt="">
                <div class="dropdown-menu" id="dropdownMenuEpay">
                    <a href="Financia-E-Pay.html">E-Pay</a>
                </div>
            </td>

            <td class="notification_box"><img class="notification_button"
                    src="Financia_Home_Page_Images/Notification bell.png" alt=""></td>
            <td class="account_box">
                <img class="account" id="accountBtn" src="Financia_Home_Page_Images/Account profile.png" alt="">
                <div class="dropdown-menu" id="dropdownMenuAccount">
                    <a href="Financia_Sign_In.html">Sign In</a>
                    <a href="Financia_Sign_Up.php">Sign Up</a>
                    <a href="#">Account</a>

                </div>
            </td>
            <td class="settings_box"><img class="settings_button" src="Financia_Home_Page_Images/Settings logo.png"
                    alt=""></td>
        </tr>
    </table>
    <table class="table2">
        <form action="">
            <tr>
                <td class="td_link">
                    <a class="nav_link" href="Financia_Dashboard_Overview.php">Overview</a>
                </td>
                <td class="td_link">
                    <a class="nav_link" href="Financia_Dashboard_Summary.html">Summary</a>
                </td>
                <td class="td_link">
                    <a class="nav_link" href="Financia_History.php">History</a>
                </td>
                <td class="td_link">
                    <a class="nav_link" href="Financia_Transactions.html">Transactions</a>
                </td>
                <td class="td_link">
                    <a class="nav_link" href="Financia_Reports.html">Reports</a>
                </td>
            </tr>
        </form>
    </table>
    <div class="summary-title">
        <h1>Summary</h1>
    </div>
    <div class="summary-container">
        <div class="filter-bar">
            <select>
                <option>Starting Month & Year</option>
            </select>
            <select>
                <option>End Month & Year</option>
            </select>
            <button>✔</button>
            <button>✖</button>
        </div>
        <table class="summary-table">
            <thead>
                <tr>
                    <th>Month</th>
                    <th>Income</th>
                    <th>Expenses</th>
                    <th>Net Profit</th>
                    <th>Balance</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows will be populated dynamically -->
            </tbody>
        </table>
    </div>

    <div class="summary-title">
        <h1>Overall Summary</h1>
    </div>
    <div class="summary-container">
        <div class="filter-bar">
            <select>
                <option>Starting Month</option>
            </select>
            <select>
                <option>End Month</option>
            </select>
            <button>✔</button>
            <button>✖</button>
        </div>
        <div class="content">
            <div class="box">
                <h3>Total Income : <span id="totalIncome">₱ 0.00</span></h3>
                <p>Over the five months, the total income from all sources amounted to <span id="totalIncomeText">₱0.00</span>.</p>
            </div>
            <div class="box">
                <h3>Total Net Profit : <span id="totalNetProfit">₱ 0.00</span></h3>
                <p>The net profit, which is the difference between income and expenses, totaled <span id="totalNetProfitText">₱0.00</span> across the five months.</p>
            </div>
            <div class="box">
                <h3>Total Expenses : <span id="totalExpenses">₱ 0.00</span></h3>
                <p>Total expenses for the five-month period were <span id="totalExpensesText">₱0.00</span>.</p>
            </div>
            <div class="box">
                <h3>Total Savings : ₱ 2,800</h3>
                <p>From the net profit, a total of ₱2,800 was set aside in savings over the five months, showing disciplined savings behavior.</p>
            </div>
        </div>
    </div>
    </div>

    <div class="summary-title">
        <h1>Goal Summary</h1>
    </div>
    <div class="summary-container">
        <div class="filter-bar">
            <select>
                <option>Goal Status</option>
            </select>
            <input type="text" class="search-bar" placeholder="Search goals..." />
            <select>
                <option>Clear Goal</option>
            </select>
        </div>
        <table class="summary-table">
            <thead>
                <tr>
                    <th>Edit</th>
                    <th>Goal Name</th>
                    <th>Target</th>
                    <th>Deadline</th>
                    <th>Progress</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="goalSummaryTableBody">
                <!-- Goal rows will be populated dynamically -->
            </tbody>
        </table>
    </div>

    <div>
        <hr style="margin: 12vw 0 0 -1vw; border: 0.1vw solid black; width: 39vw;">
        <hr style="width: 10vw; border: 0.1vw solid black; margin: -0.2vw 0 0 40vw;">
        <hr style="width: 3vw; border: 0.1vw solid black; margin: -0.2vw 0 0 53.5vw;">
        <hr style="width: 38.2vw; border: 0.1vw solid black; margin: -0.2vw 0 0 60vw;">
    </div>
    <div class="div6">
        <img class="social_media_logo" src="Financia_Home_Page_Images/facebook.png" alt="">
        <img class="social_media_logo" src="Financia_Home_Page_Images/twitter.png" alt="">
        <img class="social_media_logo" src="Financia_Home_Page_Images/tiktok.png" alt="">
        <img class="social_media_logo" src="Financia_Home_Page_Images/instagram.png" alt="">
    </div>
    <table class="table5">
        <tr>
            <td class="footer_link_box"><a class="footer_links" href="Financia-AboutUs-html">About Us</a></td>
            <td class="footer_link_box"><a class="footer_links" href="">Terms & Conditions</a></td>
            <td class="footer_link_box"><a class="footer_links" href="">Privacy Policy</a></td>
            <td class="footer_link_box"><a class="footer_links" href="">Contact Us</a></td>
        </tr>
    </table>
    <br>
    <hr style="border: 0.1vw solid black; width: 99.2vw; margin: 0 -1vw 0 -1vw;">
    <p class="copyright">&copy; 2024 Financia. All Rights Reserved.</p>

    <script>
        // E-Pay Dropdown
        const epayBtn = document.getElementById('epayBtn');
        const dropdownMenuEpay = document.getElementById('dropdownMenuEpay');

        // Account Dropdown
        const accountBtn = document.getElementById('accountBtn');
        const dropdownMenuAccount = document.getElementById('dropdownMenuAccount');

        // Toggle visibility of E-Pay dropdown
        epayBtn.addEventListener('click', (event) => {
            event.stopPropagation(); // Prevent click from bubbling up
            dropdownMenuEpay.style.display =
                dropdownMenuEpay.style.display === 'block' ? 'none' : 'block';
            dropdownMenuAccount.style.display = 'none'; // Close other dropdown
        });

        // Toggle visibility of Account dropdown
        accountBtn.addEventListener('click', (event) => {
            event.stopPropagation(); // Prevent click from bubbling up
            dropdownMenuAccount.style.display =
                dropdownMenuAccount.style.display === 'block' ? 'none' : 'block';
            dropdownMenuEpay.style.display = 'none'; // Close other dropdown
        });

        // Close dropdowns when clicking outside
        window.addEventListener('click', () => {
            dropdownMenuEpay.style.display = 'none';
            dropdownMenuAccount.style.display = 'none';
        });

        // Assuming you have a function to fetch transactions
        function calculateMonthlyTotals(transactions) {
            const monthlyData = {};

            transactions.forEach(transaction => {
                const date = new Date(transaction.created_at);
                const month = date.toLocaleString('default', { month: 'long', year: 'numeric' });
                const amount = parseFloat(transaction.amount);

                if (!monthlyData[month]) {
                    monthlyData[month] = { income: 0, expenses: 0 };
                }

                if (transaction.transaction_type === 'Deposit') {
                    monthlyData[month].income += amount;
                } else if (transaction.transaction_type === 'Withdraw') {
                    monthlyData[month].expenses += amount;
                }
            });

            return monthlyData;
        }

        // Example usage after fetching transactions
        fetch('backend/get_transactions.php')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const monthlyTotals = calculateMonthlyTotals(data.transactions);
                    updateSummaryTable(monthlyTotals);
                    updateOverallSummary(data.transactions); // Ensure this is called
                }
            });

        function updateSummaryTable(monthlyTotals) {
            const summaryTableBody = document.querySelector('.summary-table tbody');
            summaryTableBody.innerHTML = ''; // Clear existing rows

            for (const month in monthlyTotals) {
                const income = monthlyTotals[month].income;
                const expenses = monthlyTotals[month].expenses;
                const netProfit = income - expenses;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${month}</td>
                    <td>₱ ${income.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td>₱ ${expenses.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                    <td>₱ ${netProfit.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
                `;
                summaryTableBody.appendChild(row);
            }
        }

        function updateOverallSummary(transactions) {
            let totalIncome = 0;
            let totalExpenses = 0;

            transactions.forEach(transaction => {
                if (transaction.transaction_type === 'Deposit') {
                    totalIncome += parseFloat(transaction.amount);
                } else if (transaction.transaction_type === 'Withdraw') {
                    totalExpenses += parseFloat(transaction.amount);
                }
            });

            const totalNetProfit = totalIncome - totalExpenses;

            // Debugging logs
            console.log('Total Income:', totalIncome);
            console.log('Total Expenses:', totalExpenses);
            console.log('Total Net Profit:', totalNetProfit);

            // Update the HTML elements with the calculated values
            document.getElementById('totalIncome').textContent = `₱ ${totalIncome.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('totalIncomeText').textContent = `₱ ${totalIncome.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('totalExpenses').textContent = `₱ ${totalExpenses.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('totalExpensesText').textContent = `₱ ${totalExpenses.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('totalNetProfit').textContent = `₱ ${totalNetProfit.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('totalNetProfitText').textContent = `₱ ${totalNetProfit.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

            // Set the balance to be equal to the net profit
            document.getElementById('netProfitBalance').textContent = `₱ ${totalNetProfit.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }

        function loadGoalSummary() {
            fetch('backend/get_goals.php', {
                method: 'GET',
                credentials: 'same-origin' // Include cookies
            })
            .then(response => response.json())
            .then(data => {
                const goalSummaryTableBody = document.getElementById('goalSummaryTableBody');
                goalSummaryTableBody.innerHTML = ''; // Clear existing rows

                if (data.success && data.goals.length > 0) {
                    data.goals.forEach(goal => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><i class="fa fa-edit" title="Edit" style="cursor: pointer;"></i></td>
                            <td>${goal.goal_name}</td>
                            <td>₱ ${goal.min_target_amount} - ₱ ${goal.max_target_amount}</td>
                            <td>${goal.deadline}</td>
                            <td>${goal.progress}%</td>
                            <td><i class="fa fa-trash" title="Delete" style="cursor: pointer;" onclick="deleteGoal(${goal.id})"></i></td>
                        `;
                        goalSummaryTableBody.appendChild(row);
                    });
                } else {
                    goalSummaryTableBody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center;">No goals found</td>
                        </tr>
                    `;
                }
            })
            .catch(error => console.error('Error loading goals:', error));
        }

        // Call this function after fetching transactions or when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadGoalSummary(); // Load goals when the page is ready
        });
    </script>

</body>

</html>